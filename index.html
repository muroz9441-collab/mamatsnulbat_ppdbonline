<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPDB Online - MA NURUL ULUM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .hero-pattern { background-color: #ffffff; background-image: radial-gradient(#3b82f6 0.5px, #ffffff 0.5px); background-size: 20px 20px; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-slate-50">
    <nav class="fixed w-full z-50 bg-white/80 backdrop-blur-md border-b border-slate-100">
        <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <img src="logo.jpg" class="h-12 w-12 rounded-xl shadow-md" alt="Logo">
                <h1 class="text-xl font-bold text-blue-900 leading-none">MA NURUL ULUM</h1>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="showAdminLogin()" class="text-sm font-semibold text-slate-600 italic">Panel Admin</button>
                <button onclick="document.getElementById('daftar-section').scrollIntoView()" class="bg-blue-600 text-white px-6 py-2.5 rounded-full text-sm font-bold hover:bg-blue-700 transition-all">Daftar</button>
            </div>
        </div>
    </nav>

    <section class="pt-32 pb-20 px-6 hero-pattern">
        <div class="max-w-7xl mx-auto grid md:grid-cols-2 gap-12 items-center">
            <div>
                <h2 class="text-5xl md:text-6xl font-black text-slate-900 leading-tight mb-8">Masa Depan Cemerlang Dimulai Di Sini</h2>
                <p class="text-lg text-slate-600 mb-10 italic">Penerimaan Peserta Didik Baru MA Nurul Ulum Batursari.</p>
                <img id="hero-img" src="https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=1000" class="rounded-[2rem] shadow-2xl w-full h-[400px] object-cover border-8 border-white">
            </div>
        </div>
    </section>

    <section id="admin-dashboard-section" class="hidden max-w-7xl mx-auto px-6 py-12">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-3xl font-black text-slate-900">Dashboard Panitia</h2>
            <div class="flex gap-3">
                <button onclick="exportToPDF()" class="bg-red-600 text-white px-5 py-3 rounded-2xl text-sm font-bold shadow-lg hover:bg-red-700">
                    <i class="fas fa-file-pdf mr-2"></i> Export PDF
                </button>
                <button onclick="location.reload()" class="bg-slate-200 px-5 py-3 rounded-2xl text-sm font-bold">Keluar</button>
            </div>
        </div>
        <div class="bg-white rounded-3xl shadow-xl overflow-x-auto border border-slate-100">
            <table class="w-full text-left">
                <thead class="bg-slate-50 border-b">
                    <tr>
                        <th class="p-6">Siswa</th>
                        <th class="p-6">Dokumen</th>
                        <th class="p-6">Status</th>
                    </tr>
                </thead>
                <tbody id="admin-table-body" class="divide-y divide-slate-50"></tbody>
            </table>
        </div>
    </section>

    <div id="modal-doc" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/80 p-6">
        <div class="bg-white rounded-3xl max-w-2xl w-full p-8 relative">
            <button onclick="this.parentElement.parentElement.classList.add('hidden')" class="absolute -top-4 -right-4 bg-white w-10 h-10 rounded-full font-bold shadow-xl text-xl">&times;</button>
            <h3 id="doc-title" class="text-xl font-bold mb-4 text-center"></h3>
            <img id="doc-img" src="" class="w-full h-auto rounded-xl shadow-inner border">
        </div>
    </div>
    <script>
        // MASUKKAN URL & KEY SUPABASE ANDA DI SINI
        const SUPABASE_URL = 'https://xyz.supabase.co'; 
        const SUPABASE_KEY = 'eyJh...'; 
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let pendaftarList = [];

        async function fetchPendaftar() {
            const { data, error } = await supabaseClient.from('pendaftar').select('*').order('created_at', { ascending: false });
            if (data) {
                pendaftarList = data;
                renderAdminTable();
            }
        }

        function renderAdminTable() {
            const tbody = document.getElementById('admin-table-body');
            tbody.innerHTML = pendaftarList.map(item => `
                <tr>
                    <td class="p-6">
                        <div class="flex items-center gap-4">
                            <img src="${item.foto || 'logo.jpg'}" class="w-12 h-12 rounded-xl object-cover border">
                            <div>
                                <div class="font-bold text-slate-900">${item.nama}</div>
                                <div class="text-[10px] text-blue-500 font-bold uppercase">${item.reg || 'MENUNGGU'}</div>
                            </div>
                        </div>
                    </td>
                    <td class="p-6 space-y-1">
                        <button onclick="viewDoc('${item.file_ijazah}', 'Ijazah - ${item.nama}')" class="block w-full text-left text-[10px] bg-blue-50 text-blue-600 p-1 rounded font-bold italic">LIHAT IJAZAH</button>
                        <button onclick="printCard('${item.reg}')" class="block w-full text-left text-[10px] bg-red-50 text-red-600 p-1 rounded font-bold italic underline">CETAK KARTU</button>
                    </td>
                    <td class="p-6">
                        <select onchange="updateStatus('${item.id}', this.value)" class="text-[10px] border rounded p-1 font-bold">
                            <option value="Menunggu" ${item.status === 'Menunggu' ? 'selected' : ''}>MENUNGGU</option>
                            <option value="Diterima" ${item.status === 'Diterima' ? 'selected' : ''}>DITERIMA</option>
                        </select>
                    </td>
                </tr>
            `).join('');
        }

        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4');
            doc.setFontSize(18);
            doc.text('DAFTAR PENDAFTAR PPDB MA NURUL ULUM', 14, 15);
            const headers = [["No", "Reg", "Nama", "NISN", "Asal Sekolah", "Status"]];
            const dataRow = pendaftarList.map((p, index) => [index + 1, p.reg || '-', p.nama, p.nisn, p.asal_sekolah, p.status]);
            doc.autoTable({ startY: 25, head: headers, body: dataRow, theme: 'grid' });
            doc.save('Data_Pendaftar.pdf');
        }

        function printCard(reg) {
            const data = pendaftarList.find(p => p.reg === reg);
            if (!data) return alert("Data tidak ditemukan");
            const win = window.open('', '_blank');
            win.document.write(`<html><body style="font-family:sans-serif; padding:20px;" onload="window.print(); window.close();">
                <div style="border:3px solid #1e3a8a; padding:20px; width:400px; border-radius:15px; text-align:center;">
                    <h2>KARTU PPDB MA NURUL ULUM</h2>
                    <hr><p>Nama: <b>${data.nama}</b></p><p>Reg: ${data.reg}</p>
                </div></body></html>`);
        }

        function viewDoc(src, title) {
            document.getElementById('doc-title').innerText = title;
            document.getElementById('doc-img').src = src;
            document.getElementById('modal-doc').classList.remove('hidden');
            document.getElementById('modal-doc').classList.add('flex');
        }

        function showAdminLogin() {
            const pw = prompt("Password Admin:");
            if (pw === "admin123") {
                document.getElementById('admin-dashboard-section').classList.remove('hidden');
                fetchPendaftar();
            }
        }
    </script>
</body>
</html>
// Lanjutan baris 156
        async function fetchPendaftar() {
            const { data, error } = await supabaseClient
                .from('pendaftar')
                .select('*')
                .order('created_at', { ascending: false });
            if (data) {
                pendaftarList = data;
                renderAdminTable();
            }
        }

        function renderAdminTable() {
            const tbody = document.getElementById('admin-table-body');
            tbody.innerHTML = pendaftarList.map(item => `
                <tr class="hover:bg-slate-50/50 transition-colors">
                    <td class="p-6">
                        <div class="flex items-center gap-4">
                            <img src="${item.foto || 'logo.jpg'}" class="w-12 h-12 rounded-xl object-cover shadow-sm border">
                            <div>
                                <div class="font-bold text-slate-900">${item.nama}</div>
                                <div class="text-[10px] font-bold text-blue-500 uppercase tracking-tight">${item.reg || 'Pending'}</div>
                            </div>
                        </div>
                    </td>
                    <td class="p-6 space-y-1">
                        <button onclick="viewDoc('${item.file_ijazah}', 'Ijazah - ${item.nama}')" class="block w-full text-left text-[10px] bg-blue-50 text-blue-600 p-1 rounded font-bold italic">IJAZAH</button>
                        <button onclick="viewDoc('${item.file_kk}', 'KK - ${item.nama}')" class="block w-full text-left text-[10px] bg-purple-50 text-purple-600 p-1 rounded font-bold italic">KK</button>
                        <button onclick="printCard('${item.reg}')" class="block w-full text-left text-[10px] bg-red-50 text-red-600 p-1 rounded font-bold italic underline">CETAK KARTU</button>
                    </td>
                    <td class="p-6 text-center">
                        <select onchange="updateStatus('${item.id}', this.value)" class="text-[10px] font-bold border rounded p-1">
                            <option value="Menunggu" ${item.status === 'Menunggu' ? 'selected' : ''}>MENUNGGU</option>
                            <option value="Diterima" ${item.status === 'Diterima' ? 'selected' : ''}>DITERIMA</option>
                            <option value="Ditolak" ${item.status === 'Ditolak' ? 'selected' : ''}>DITOLAK</option>
                        </select>
                    </td>
                </tr>
            `).join('');
        }

        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4');
            doc.setFontSize(18);
            doc.text('DAFTAR PENDAFTAR PPDB MA NURUL ULUM', 14, 15);
            const headers = [["No", "No. Registrasi", "Nama Lengkap", "NISN", "Asal Sekolah", "Status"]];
            const dataRow = pendaftarList.map((p, index) => [
                index + 1, p.reg || '-', p.nama, p.nisn, p.asal_sekolah || '-', p.status || 'MENUNGGU'
            ]);
            doc.autoTable({
                startY: 25,
                head: headers,
                body: dataRow,
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] }
            });
            doc.save('Data_Pendaftar_PPDB.pdf');
        }

        function printCard(reg) {
            const data = pendaftarList.find(p => p.reg === reg);
            if (!data) return alert("Data tidak ditemukan");
            const win = window.open('', '_blank');
            win.document.write(\`
                <html>
                <body style="font-family:sans-serif; padding:20px;" onload="window.print(); window.close();">
                    <div style="border:3px solid #1e3a8a; padding:20px; width:400px; border-radius:15px; text-align:center;">
                        <h2>KARTU PPDB MA NURUL ULUM</h2>
                        <hr><p>Nama: <b>\${data.nama}</b></p><p>Reg: \${data.reg}</p>
                    </div>
                </body>
                </html>
            \`);
            win.document.close();
        }

        function viewDoc(src, title) {
            document.getElementById('doc-title').innerText = title;
            document.getElementById('doc-img').src = src;
            document.getElementById('modal-doc').classList.remove('hidden');
            document.getElementById('modal-doc').classList.add('flex');
        }

        function closeDoc() {
            document.getElementById('modal-doc').classList.add('hidden');
        }

        function showAdminLogin() {
            const pw = prompt("Password Admin:");
            if (pw === "admin123") {
                document.getElementById('admin-dashboard-section').classList.remove('hidden');
                fetchPendaftar();
            }
        }
    </script>
</body>
</html>
// --- LANJUTAN BARIS 254 SAMPAI SELESAI ---
        async function fetchPendaftar() {
            const { data, error } = await supabaseClient
                .from('pendaftar')
                .select('*')
                .order('created_at', { ascending: false });
            if (data) {
                pendaftarList = data;
                renderAdminTable();
            }
        }

        function renderAdminTable() {
            const tbody = document.getElementById('admin-table-body');
            tbody.innerHTML = pendaftarList.map(item => `
                <tr class="hover:bg-slate-50/50 transition-colors">
                    <td class="p-6">
                        <div class="flex items-center gap-4">
                            <img src="${item.foto || 'logo.jpg'}" class="w-12 h-12 rounded-xl object-cover shadow-sm border">
                            <div>
                                <div class="font-bold text-slate-900">${item.nama}</div>
                                <div class="text-[10px] font-bold text-blue-500 uppercase tracking-tight">${item.reg || 'Pending'}</div>
                            </div>
                        </div>
                    </td>
                    <td class="p-6 space-y-1">
                        <button onclick="viewDoc('${item.file_ijazah}', 'Ijazah - ${item.nama}')" class="block w-full text-left text-[10px] bg-blue-50 text-blue-600 p-1 rounded font-bold italic">IJAZAH</button>
                        <button onclick="viewDoc('${item.file_kk}', 'KK - ${item.nama}')" class="block w-full text-left text-[10px] bg-purple-50 text-purple-600 p-1 rounded font-bold italic">KK</button>
                        <button onclick="printCard('${item.reg}')" class="block w-full text-left text-[10px] bg-red-50 text-red-600 p-1 rounded font-bold italic underline">CETAK KARTU</button>
                    </td>
                    <td class="p-6 text-center">
                        <select onchange="updateStatus('${item.id}', this.value)" class="text-[10px] font-bold border rounded p-1">
                            <option value="Menunggu" ${item.status === 'Menunggu' ? 'selected' : ''}>MENUNGGU</option>
                            <option value="Diterima" ${item.status === 'Diterima' ? 'selected' : ''}>DITERIMA</option>
                            <option value="Ditolak" ${item.status === 'Ditolak' ? 'selected' : ''}>DITOLAK</option>
                        </select>
                    </td>
                </tr>
            `).join('');
        }

        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4');
            doc.setFontSize(18);
            doc.text('DAFTAR PENDAFTAR PPDB MA NURUL ULUM', 14, 15);
            const headers = [["No", "Reg", "Nama Lengkap", "NISN", "Asal Sekolah", "Status"]];
            const dataRow = pendaftarList.map((p, index) => [
                index + 1, p.reg || '-', p.nama, p.nisn, p.asal_sekolah || '-', p.status || 'MENUNGGU'
            ]);
            doc.autoTable({
                startY: 25,
                head: headers,
                body: dataRow,
                theme: 'grid',
                headStyles: { fillColor: [30, 58, 138] }
            });
            doc.save('Data_Pendaftar_PPDB.pdf');
        }

        function printCard(reg) {
            const data = pendaftarList.find(p => p.reg === reg);
            if (!data) return alert("Data tidak ditemukan");
            const win = window.open('', '_blank');
            win.document.write(`
                <html>
                <body style="font-family:sans-serif; padding:40px; text-align:center;" onload="window.print(); window.close();">
                    <div style="border:5px solid #1e3a8a; padding:20px; border-radius:20px; display:inline-block;">
                        <h2>KARTU PENDAFTARAN PPDB</h2>
                        <hr>
                        <p>Nama: <b>${data.nama}</b></p>
                        <p>No Registrasi: <b>${data.reg || '-'}</b></p>
                    </div>
                </body>
                </html>
            `);
win.document.close();
    }

    function viewDoc(src, title) {
        const modal = document.getElementById('modal-doc');
        document.getElementById('doc-title').innerText = title;
        document.getElementById('doc-img').src = src;
        modal.classList.remove('hidden');
        modal.classList.add('flex');
    }

    function closeDoc() {
        document.getElementById('modal-doc').classList.add('hidden');
    }

    function showAdminLogin() {
        const pw = prompt("Password Admin:");
        if (pw === "admin123") {
            document.getElementById('admin-dashboard-section').classList.remove('hidden');
            fetchPendaftar();
        }
    }
</script>
</body>
</html>
